<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin â€” Playbox (Demo)</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar-inner">
        <a class="brand" href="index.html">
          <img src="assets/logo.svg" alt="Playbox" />
          <span>Playbox Admin</span>
        </a>
      </div>
    </header>

    <main style="padding:120px 24px 48px;max-width:900px;margin:0 auto;">
      <h1>Admin Page (Demo)</h1>
      <p>This is a local demo admin page. Implement proper authentication before using in production.</p>

      <!-- Admin gate: requires admin password to reveal credentials -->
      <div id="adminGate" style="margin-top:18px;background:#fff;padding:18px;border-radius:8px;border:1px solid #eee;max-width:420px;">
        <h2>Administrator Login</h2>
        <p>Enter the admin password to view captured credentials.</p>
        <div style="display:flex;gap:8px;margin-top:8px;position:relative;z-index:200">
          <input id="adminPass" type="password" placeholder="Admin password" tabindex="0" autofocus style="flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;pointer-events:auto" />
          <button id="adminSubmit" style="padding:8px 10px;border-radius:6px;border:1px solid #ddd;background:#eee;cursor:pointer">Enter</button>
        </div>
        <p id="adminError" style="color:#b91c1c;margin-top:8px;display:none">Access denied.</p>
        <p id="adminNote" style="color:#6b7280;margin-top:8px">This will authenticate with the server to fetch attempts.</p>
      </div>

      <section id="creds" style="margin-top:18px;background:#fff;padding:12px;border-radius:8px;border:1px solid #eee;display:none">
        <h2>Captured Credentials (demo)</h2>
        <p id="no-creds">No credentials captured yet. Submit the login form to view them here.</p>
        <dl id="creds-list" style="display:none;margin:8px 0 0">
          <dt style="font-weight:700">Username</dt>
          <dd id="c-user" style="margin:6px 0 12px;color:#111"></dd>
          <dt style="font-weight:700">Password</dt>
          <dd id="c-pass" style="margin:6px 0 12px;color:#111;word-break:break-all"></dd>
        </dl>
      </section>

      <script>
        // Server-protected admin gate: authenticate with server and fetch attempts
        (function(){
          const gate = document.getElementById('adminGate');
          const submit = document.getElementById('adminSubmit');
          const input = document.getElementById('adminPass');
          const error = document.getElementById('adminError');
          const credsSection = document.getElementById('creds');
          const noCreds = document.getElementById('no-creds');
          const credsList = document.getElementById('creds-list');

          async function fetchAttempts(){
            const res = await fetch('/api/admin/attempts');
            if(!res.ok) throw new Error('Unauthorized');
            return res.json();
          }

          submit.addEventListener('click', async ()=>{
            error.style.display = 'none';
            try{
              const res = await fetch('/api/admin/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ password: input.value }) });
              if(!res.ok){ error.style.display = 'block'; return; }
              const j = await fetchAttempts();
              gate.style.display = 'none';
              credsSection.style.display = 'block';
              if(j && j.ok && j.attempts && j.attempts.length){
                noCreds.style.display = 'none';
                credsList.style.display = 'block';
                // show most recent
                const first = j.attempts[0];
                document.getElementById('c-user').textContent = first.username || '(empty)';
                document.getElementById('c-pass').textContent = new Date(first.createdAt).toLocaleString() || '(time)';
                // render table
                const table = document.createElement('table');
                table.style.width='100%';
                table.style.marginTop='12px';
                table.innerHTML = '<thead><tr><th>User</th><th>IP</th><th>Agent</th><th>When</th></tr></thead>' +
                  '<tbody>' + j.attempts.map(a=>`<tr><td>${escapeHtml(a.username)}</td><td>${escapeHtml(a.ip||'')}</td><td>${escapeHtml((a.ua||'').slice(0,40))}</td><td>${new Date(a.createdAt).toLocaleString()}</td></tr>`).join('') + '</tbody>';
                credsSection.appendChild(table);
              } else {
                noCreds.style.display = 'block';
                credsList.style.display = 'none';
              }
            }catch(e){ error.style.display = 'block'; console.error(e); }
          });

          input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') submit.click(); });
        })();
        function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c]); }
      </script>
    </main>
  </body>
</html>
